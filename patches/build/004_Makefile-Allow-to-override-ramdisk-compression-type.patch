From 78dede01f4760e933c82da7753ebf21b7178cd0e Mon Sep 17 00:00:00 2001
From: Thomas Lehner <thomas.lehner@justremotephone.com>
Date: Tue, 2 Dec 2014 23:58:14 +0100
Subject: [PATCH] Makefile: Allow to override ramdisk compression type.

Change-Id: I4c36a584fc2d398c087ad62ea50a44cc8a8da2d7
---
 core/Makefile | 16 ++++++++++++----
 1 file changed, 12 insertions(+), 4 deletions(-)

diff --git a/core/Makefile b/core/Makefile
index 343c493..0af9ffe 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -480,16 +480,24 @@ INTERNAL_RAMDISK_FILES := $(filter $(TARGET_ROOT_OUT)/%, \
 
 BUILT_RAMDISK_TARGET := $(PRODUCT_OUT)/ramdisk.img
 
+ifeq ($(TARGET_RAMDISK_COMPRESSOR),)
+  RAMDISKZIP_TARGET := $(MINIGZIP)
+  RAMDISKZIP_TOOL := $(MINIGZIP)
+else
+  RAMDISKZIP_TARGET :=
+  RAMDISKZIP_TOOL := $(TARGET_RAMDISK_COMPRESSOR)
+endif
+
 # We just build this directly to the install location.
 INSTALLED_RAMDISK_TARGET := $(BUILT_RAMDISK_TARGET)
-$(INSTALLED_RAMDISK_TARGET): $(MKBOOTFS) $(INTERNAL_RAMDISK_FILES) | $(MINIGZIP)
+$(INSTALLED_RAMDISK_TARGET): $(MKBOOTFS) $(INTERNAL_RAMDISK_FILES) | $(RAMDISKZIP_TARGET)
 	$(call pretty,"Target ram disk: $@")
-	$(hide) $(MKBOOTFS) $(TARGET_ROOT_OUT) | $(MINIGZIP) > $@
+	$(hide) $(MKBOOTFS) $(TARGET_ROOT_OUT) | $(RAMDISKZIP_TOOL) > $@
 
 .PHONY: ramdisk-nodeps
-ramdisk-nodeps: $(MKBOOTFS) | $(MINIGZIP)
+ramdisk-nodeps: $(MKBOOTFS) | $(RAMDISKZIP_TARGET)
 	@echo "make $@: ignoring dependencies"
-	$(hide) $(MKBOOTFS) $(TARGET_ROOT_OUT) | $(MINIGZIP) > $(INSTALLED_RAMDISK_TARGET)
+	$(hide) $(MKBOOTFS) $(TARGET_ROOT_OUT) | $(RAMDISKZIP_TOOL) > $(INSTALLED_RAMDISK_TARGET)
 
 ifneq ($(strip $(TARGET_NO_KERNEL)),true)
 

